#{extends 'main.html' /}
#{set title:'Home' /}

<div class="tabbable">
    <ul class="nav nav-tabs">
        <li class="active"><a href="#SprintbacklogIT" data-toggle="tab">Sprintbacklog (IT)</a></li>
        <li><a href="#SprintbacklogBA" data-toggle="tab">Sprintbacklog (BA)</a></li>
        <li><a href="#Burndown" data-toggle="tab" id="BurndownTabTitle"">Burndown</a></li>
    </ul>
    <div class="tab-content">
        <div class="tab-pane active" id="SprintbacklogIT">
            <form action="/SprintBacklogPlus/show" method="GET" id="frmMain" name="frmMain">
                Sprint
                <select name="selectedSprint.id" onchange="$('#frmMain').submit()">
                    #{list items:sprints, as:'sprint'}
                    <option value="${sprint.id}"
                    #{if selectedSprint == sprint}selected#{/if}> ${sprint.sprintName}</option>
                    #{/list}
                </select>

                Team
                <select name="selectedTeam" onchange="$('#frmMain').submit()">
                    <option value=""> All</option>
                    #{list items:teams, as:'team'}
                    <option value="${team}"
                    #{if selectedTeam == team}selected#{/if}> ${team}</option>
                    #{/list}

                </select>
            </form>



    <table>
    <tr>
    <td><div class="progress progress-success progress-striped" style="width: 60px;"><div class="bar" style="width: 100%; color: #000000;" >Day&nbsp;1</div></div></td>
    <td><div class="progress progress-warning progress-striped" style="width: 60px;"><div class="bar" style="width: 20%; color: #000000;" >Day&nbsp;2</div></div></td>
    <td><div class="progress progress-danger progress-striped" style="width: 60px;"><div class="bar" style="width: 100%; color: #000000;" >Day&nbsp;3</div></div></td>
    </tr>
    </table>

            <p>Total Remaining: ${totalRemainingInDays} day(s)</p>
            <table class="table table-striped table-bordered tablesorter" id="tableJiraList">
                <thead>
                <tr>
                    <th>Category</th>
                    <th>Business Jira</th>
                    <th>IT Jira</th>
                    <th>Description</th>
                    <th>Priority</th>
                    <th>Status</th>
                    <th>Assignee</th>
                    <th>Team</th>
                    <th>Estimate</th>
                    <th>Actual</th>
                    <th>Remaining</th>
                </tr>
                </thead>
                <tbody>
                #{list items:sprintJiras, as:'jira'}
                <tr>
                    <td><span class="${jira.jiraDetail.cssClassByCategory}">${jira.jiraCategory}</span></td>
                    <td>
                        #{if jiraDetail?.counterpartJira}
                            #{if jira.jiraDetail.counterpartJira?.jiraNumber}
                                #{if jira.jiraDetail.counterpartJira?.parentJira}
                                    #{if jira.jiraDetail.counterpartJira.parentJira?.jiraNumber}
                            <a href="http://jira.london.echonet/browse/${jira.jiraDetail.counterpartJira.jiraNumber}" data-content="${jira.jiraDetail.counterpartJira.description}" class="jiraLink">${jira.jiraDetail.counterpartJira.jiraNumber}</a><br>&nbsp;&nbsp;
                                    #{/if}
                                #{/if}
                            #{/if}
                        #{/if}
                        #{if jiraDetail?.counterpartJira}
                            #{if jira.jiraDetail.counterpartJira?.jiraNumber}
                                <a href="http://jira.london.echonet/browse/${jira.jiraDetail.counterpartJira.jiraNumber}" title="${jira.jiraDetail.counterpartJira.jiraNumber}" data-content="${jira.jiraDetail.counterpartJira.description}" class="jiraLink">${jira.jiraDetail.counterpartJira.jiraNumber}</a>
                            #{/if}
                        #{/if}
                    </td>
                    <td>
                        #{if jiraDetail?.parentJira}
                            <a href="http://jira.london.echonet/browse/${jira.jiraDetail.parentJira.jiraNumber}" data-content="${jira.jiraDetail.parentJira.description}" class="jiraLink">${jira.jiraDetail.parentJira.jiraNumber}</a><br>&nbsp;&nbsp;
                        #{/if}
                        <a href="http://jira.london.echonet/browse/${jira.jiraDetail.jiraNumber}">${jira.jiraNumber}</a>
                    </td>
                    <td>${jira.jiraDetail.description}</td>
                    <td>${jira.jiraDetail.priority}</td>
                    <td nowrap><span class="${jira.jiraDetail.cssClassByStatus}">${jira.jiraDetail.status}</span></td>
                    <td>${jira.jiraDetail.assignee}</td>
                    <td>${jira.jiraDetail.team}</td>
                    <td>${jira.sprintEstimate}</td>
                    <td>
                        ${jira.actual}
                        &nbsp;&nbsp;&nbsp;<a class="btn btn-mini btn-primary" data-toggle="modal" href="#addActualModal${jira.jiraNumber}"><i class="icon-plus icon-white"></i> Add</a>
                    </td>
                    <td>
                        ${jira.remaining}
                        &nbsp;&nbsp;&nbsp;<a class="btn btn-mini btn-primary" data-toggle="modal" href="#setRemainingModal${jira.jiraNumber}"><i class="icon-pencil icon-white"></i> Set</a>
                    </td>
                </tr>

                <div class="modal hide" id="addActualModal${jira.jiraNumber}">
                    <form id="actualForm${jira.jiraNumber}">
                        <input name="jira.id" value="${jira.id}" type="hidden">
                        <div class="modal-header">
                            <a class="close" data-dismiss="modal">×</a>
                            <h3>Add actuals: ${jira.jiraNumber} ${jira.jiraDetail.description}</h3>
                        </div>
                        <div class="modal-body">
                            <p>Kunal: 1 Day</p>
                            <p>Pranav: 2.5 Day</p>
                            <p>
                            <select name="date">
                                #{list items:sprintDays, as:'sprintDay'}
                                    <option value='${sprintDay.key.format("dd-MM-yyyy")}'>${sprintDay.value}</option>
                                #{/list}
                            </select>
                            Time<select name="timeInHours">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                                <option value="8">8</option>
                            </select>
                            </p>
                        </div>
                        <div class="modal-footer">
                            <a href="#" class="btn"  data-dismiss="modal">Close</a>
                            <a href="#" class="btn btn-primary" onclick="saveActual('${jira.jiraNumber}')">Save</a>
                        </div>
                    </form>
                </div>

                <div class="modal hide" id="setRemainingModal${jira.jiraNumber}">
                    <div id="remainingDiv${jira.jiraNumber}" style="height:400px;width:300px; visibility: visible; "></div>
                    <script type="text/javascript">
                        $('#setRemainingModal${jira.jiraNumber}').on('shown', function (e) {
                            $.jqplot('remainingDiv${jira.jiraNumber}',  [
                                                        [[0, 100],[1, 90],[2,80],[3,70],[4,60],[5,50],[6,40],[7,30],[8,20],[9,10],[10,0]],
                                                        [[0, 100],[1, 95],[2,85],[3,75],[4,65],[5,50],[6,40],[7,30],[8,25],[9,10],[10,0]]
                                                    ]);

                        });
                    </script>

                    <form id="remainingForm${jira.jiraNumber}">
                        <input name="jira.id" value="${jira.id}" type="hidden">
                        <div class="modal-header">
                            <a class="close" data-dismiss="modal">×</a>

                            <h3>Set Remaining: ENT-2313 Fit test correction</h3>
                        </div>
                        <div class="modal-body">
                            <p>Day 1: 1 Day</p>
                            <p>Day 4: 2.5 Day</p>
                            <p>
                            Day
                                <select name="date">
                                #{list items:sprintDays, as:'sprintDay'}
                                    <option value='${sprintDay.key.format("dd-MM-yyyy")}'>${sprintDay.value}</option>
                                #{/list}
                                </select>
                                <input type="text" name="timeInHours"/>
                            </p>
                        </div>
                        <div class="modal-footer">
                            <a href="#" class="btn"  data-dismiss="modal">Close</a>
                            <a href="#" class="btn btn-primary" onclick="saveRemaining('${jira.jiraNumber}')">Save</a>
                        </div>
                    </form>
                </div>
                #{/list}

                </tbody>
            </table>

            <script type="text/javascript">
                $(document).ready(function()
                    {
                        $("#tableJiraList").tablesorter();
                        $("#SprintBacklogPlus").addClass("active");

                    }
                );
            </script>
        </div>
        <div class="tab-pane" id="SprintbacklogBA">
            <p>Yet to come.</p>
        </div>
        <div class="tab-pane" id="Burndown">
            <div id="burnDownDiv" style="height:400px;width:300px; visibility: visible; "></div>
        </div>
    </div>
</div>
<script type="text/javascript">
    $().ready(function () {
        $("a.jiraLink").popover({});

        $('#BurndownTabTitle').on('shown', function (e) {
            $.jqplot('burnDownDiv',  [
                                        [[0, 100],[1, 90],[2,80],[3,70],[4,60],[5,50],[6,40],[7,30],[8,20],[9,10],[10,0]],
                                        [[0, 100],[1, 95],[2,85],[3,75],[4,65],[5,50],[6,40],[7,30],[8,25],[9,10],[10,0]]
                                    ]);
        });
    });

    function saveActual(jiraReference) {
         $.post('/SprintBacklogPlus/saveActual', $('#actualForm' + jiraReference).serializeArray(), function(data) {
             $("#addActualModal" + jiraReference).modal('hide');
        }, "json");
    }

    function saveRemaining(jiraReference) {
         $.post('/SprintBacklogPlus/saveRemaining', $('#remainingForm' + jiraReference).serializeArray(), function(data) {
             $("#setRemainingModal" + jiraReference).modal('hide');
        }, "json");
    }
</script>
